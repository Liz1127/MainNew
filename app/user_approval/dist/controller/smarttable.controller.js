sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/m/Dialog","sap/m/Button","sap/m/Select","sap/ui/core/Item"],function(e,t,s,n,a,i){"use strict";return e.extend("my.userapproval.controller.smarttable",{onInit:function(){var e=new sap.ui.model.odata.v2.ODataModel("/odata/v2/user-validity");e.refreshMetadata();this.getView().setModel(e);this._selectedItem=null;var t=this.byId("smartTable");var s=t.getTable();s.attachRowSelectionChange(this.onSelectionChange,this)},onSelectionChange:function(e){var t=e.getSource();var s=t.getSelectedIndex();var n=t.getContextByIndex(s);var a=this.byId("sendEmailButton");var i=this.byId("editAssignmentButton");if(n){this._selectedItem=n.getObject();console.log("Selected Item:",this._selectedItem);var o=this._selectedItem.status;if(o==="1 week to go"||o==="3 days to go"||o==="1 day to go"){a.setEnabled(true);i.setEnabled(true);if(!this._selectedItem.assignment||this._selectedItem.assignment!=="Assigned"){this._selectedItem.assignment="Not Assigned"}}else{a.setEnabled(false);i.setEnabled(false)}}else{this._selectedItem=null;a.setEnabled(false);i.setEnabled(false);console.log("No item selected")}},onSendEmail:function(){if(!this._selectedItem){t.show("Please select a user to send an email.");return}var e=this._selectedItem.mailID;var s=this._selectedItem.status;var n=this._selectedItem.userID;if(!e){t.show("Mail ID is not available for the selected user.");return}var a=`Dear ${n}, You have ${s} before your approval access expires.`;var i={to:e,subject:"Approval Access Expiry Notification",text:a};$.ajax({url:"/odata/v4/mail/sendmail",method:"POST",contentType:"application/json",data:JSON.stringify(i),success:function(){t.show("Email sent to: "+e+"\n(User ID: "+n+")")},error:function(e){t.show("Failed to send email. Please try again.");console.error("Error sending email:",e)}})},onEditAssignment:function(){if(!this._selectedItem){t.show("Please select a user to edit the assignment.");return}var e=this._selectedItem.assignment;if(e==="Assigned"){t.show("Assignment cannot be edited once it is set to 'Assigned'.");return}var o=new s({title:"Edit Assignment",content:new a({items:[new i({text:"Assigned",key:"Assigned"}),new i({text:"Not Assigned",key:"Not Assigned"})],selectedKey:e||"Not Assigned"}),beginButton:new n({text:"Save",press:function(){var e=o.getContent()[0].getSelectedKey();this._selectedItem.assignment=e;$.ajax({url:"/odata/v4/user-validity/updateAssignment",method:"POST",contentType:"application/json",data:JSON.stringify({userID:this._selectedItem.userID,assignment:e}),success:function(){t.show("Assignment updated successfully.");o.close();var e=this.getView().getModel();e.refresh(true)}.bind(this),error:function(e){t.show("Failed to update assignment. Please try again.");console.error("Error updating assignment:",e);console.log("Error details:",e.responseText)}})}.bind(this)}),endButton:new n({text:"Cancel",press:function(){o.close()}})});this.getView().addDependent(o);o.open()}})});
//# sourceMappingURL=smarttable.controller.js.map